<ng-container *ngIf="(loggedInUser$ | async) as user ; else skeleton">
  <ng-container *ngIf="(conversation$ | async) as conversation; else skeleton">
    <div 
    *ngIf="(recipient$ | async) as recipient" 
    class="h-full flex justify-between flex-col">
      <section class="p-4" >
          <button (click)="unselectConversation()" class="md:hidden btn btn-square btn-ghost text-2xl absolute left-2 top-2">
            <fa-icon [icon]="['fas', 'angle-left']"></fa-icon>
          </button>
          <ng-container *ngIf="conversation.messages.length > 0">
            <div #chat 
            [scrollTop]="chat.scrollHeight" 
            *ngFor="let message of conversation.messages">
              <div class="chat" [ngClass]="message.senderId == user.id ? 'chat-end' : 'chat-start' ">
                <div class="chat-image avatar">
                  <div class="w-10 rounded-full">
                    <img alt="avatar" [src]="message.senderId == user.id ? user.avatar : recipient.avatar" />
                  </div>
                </div>
                <div class="chat-bubble">{{message.text}}</div>
              </div>
            </div>
          </ng-container>
        </section>
        <app-messages-create 
        [senderId]="user.id" 
        [recipientId]="recipient.id" 
        [conversationId]="conversationId">
      </app-messages-create>
    </div>
  </ng-container>
</ng-container>



<ng-template #skeleton>
  <div class="chat chat-end">
    <div class="chat-image avatar">
      <div class="w-10 rounded-full bg-base-grey">
      </div>
    </div>
    <div class="chat-bubble w-10 bg-base-grey"></div>
  </div>
</ng-template>

